<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-brand d-flex align-items-center" href="/">
        <img src="/static/images/nexa.png" alt="Nexa Store" class="brand-logo" style="height: 56px; width: auto;">
      </a>
  
      <!-- Burger -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
        aria-controls="mainNav" aria-expanded="false" aria-label="تبديل القائمة">
        <span class="navbar-toggler-icon"></span>
      </button>
  
      <!-- Menu -->
      <div class="collapse navbar-collapse" id="mainNav">
        <!-- الروابط -->
        <ul class="navbar-nav nav-menu me-auto mb-2 mb-lg-0 mt-3 mt-lg-0">
          <li class="nav-item">
            <a class="nav-link {% if request.path == '/' %}active{% endif %}" href="/">
              <i class="fas fa-home me-1"></i> الرئيسية
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if '/catalog/' in request.path %}active{% endif %}" href="/catalog/">
              <i class="fas fa-th-large me-1"></i> الكتالوج
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#contactModal">
              <i class="fas fa-headset me-1"></i> اتصل بنا
            </a>
          </li>
        </ul>
  
        <!-- البحث -->
        <form class="d-flex my-2 my-lg-0 me-lg-3 search-form" method="get" action="/catalog/">
          <div class="input-group">
            <input class="form-control border-end-0" type="search" name="q" placeholder="ابحث عن منتج..." aria-label="بحث">
            <button class="btn btn-outline-secondary border-start-0 border" type="submit">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </form>
  
        <!-- السلة / المستخدم -->
        <div class="d-flex align-items-center gap-2 my-2 my-lg-0">
          <a href="/sales/cart/" class="btn btn-outline-secondary position-relative">
            <i class="fas fa-shopping-cart"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">{{ cart_count|default:0 }}</span>
          </a>
  
          {% if request.user.is_authenticated %}
          <div class="dropdown">
            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="userDropdown"
              data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-user me-1"></i>
              {{ request.user.full_name|default:request.user.username|truncatechars:10 }}
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="/sales/cart/"><i class="fas fa-shopping-cart me-2"></i> سلة المشتريات</a></li>
              <li><a class="dropdown-item" href="/sales/favorites/"><i class="fas fa-heart me-2"></i> المفضلة</a></li>
              <li><a class="dropdown-item" href="/sales/orders/"><i class="fas fa-receipt me-2"></i> طلباتي</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" href="{% url 'identity:logout' %}">
                <i class="fas fa-sign-out-alt me-2"></i> تسجيل خروج
              </a></li>
            </ul>
          </div>
          {% else %}
          <div class="d-flex gap-2">
            <a href="{% url 'identity:login' %}" class="btn btn-outline-primary"><i class="fas fa-sign-in-alt me-1"></i> دخول</a>
            <a href="{% url 'identity:register' %}" class="btn btn-primary"><i class="fas fa-user-plus me-1"></i> حساب جديد</a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </nav>
  
  <div class="nav-spacer"></div>
  
  <style>
    /* Spacer below fixed header */
    .nav-spacer { height: 96px; }
    @media (max-width: 991.98px) { .nav-spacer { height: 108px; } }
    /* Larger, clearer brand logo */
    .brand-logo { height: 56px; width: auto; }
    @media (max-width: 360px) { .brand-logo { height: 50px; } }
    .nav-link {
      font-weight: 500;
      padding: 0.6rem 1rem;
    }
  
    .nav-link.active {
      color: #4F46E5 !important;
      font-weight: 600;
    }
  
    /* البحث - قصره في الشاشات الكبيرة */
    .search-form {
      width: 280px;
    }
    /* للهاتف: اجعل القائمة مريحة أكثر */
    @media (max-width: 991.98px) {
      #mainNav {
        background: #fff;
        padding: 1rem;
        border-radius: 0.75rem;
        margin-top: 0.5rem;
        box-shadow: 0 10px 24px rgba(0,0,0,0.06);
      }

      /* Menu card style */
      #mainNav .nav-menu {
        gap: .5rem;
        padding: .25rem;
        background: #f8fafc;
        border: 1px solid #eef2f7;
        border-radius: .75rem;
      }
      #mainNav .nav-menu .nav-link {
        font-size: 1rem;
        padding: .75rem 1rem;
        border-radius: .6rem;
        background: #ffffff;
        border: 1px solid #eef2f7;
      }
      #mainNav .nav-menu .nav-link:hover { background: #f3f6fb; }
      #mainNav .nav-menu .nav-link.active {
        background: rgba(79,70,229,.08);
        color: #4F46E5 !important;
        border-color: rgba(79,70,229,.18);
        font-weight: 700;
      }

      .search-form {
        width: 100%;
        margin: 1rem 0;
      }
      .search-form input { font-size: 0.95rem; }
    }
    
    /* Dropdown fits viewport on very small screens */
    @media (max-width: 575.98px) {
      .navbar .dropdown { position: static; }
      .navbar .dropdown-menu {
        inset: auto !important;
        right: .5rem; left: .5rem;
        width: calc(100vw - 1rem);
        transform: none !important;
        margin-top: .25rem; z-index: 1100;
      }
    }
  </style>
  
  <script>
  // Improve collapse UX for #mainNav
  document.addEventListener('DOMContentLoaded', function () {
    const mainNav = document.getElementById('mainNav');
    if (!mainNav) return;
    const closeNav = () => {
      if (mainNav.classList.contains('show')) {
        const c = bootstrap.Collapse.getOrCreateInstance(mainNav);
        c.hide();
      }
    };
    // Close on any nav link or dropdown item click
    document.querySelectorAll('#mainNav .nav-link, #mainNav .dropdown-item').forEach(el => {
      el.addEventListener('click', closeNav);
    });
    // Close on form submit
    const sf = document.querySelector('#mainNav form');
    if (sf) sf.addEventListener('submit', closeNav);
    // Click outside closes
    document.addEventListener('click', function (e) {
      const toggler = document.querySelector('.navbar-toggler');
      if (mainNav.classList.contains('show') && !mainNav.contains(e.target) && !toggler.contains(e.target)) {
        closeNav();
      }
    });
  });
  </script>